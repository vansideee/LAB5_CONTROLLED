# Lab 5: IPC / Named Pipes (Задача читателей-писателей)

## Условие задачи

**Задача:** Реализовать многопроцессное приложение (клиент-сервер) для управления доступом к записям файла сотрудников. Взаимодействие между процессами осуществляется через **именованные каналы (Named Pipes)** с использованием Windows API.

Доступ к записям регулируется алгоритмом **«Читатели-Писатели» (Readers-Writers)**:
1. Несколько клиентов могут читать одну и ту же запись одновременно.
2. Изменять запись может только один клиент, блокируя доступ остальным (и на чтение, и на запись).
3. Ожидающие запросы становятся в очередь на стороне сервера.

### 1. Процесс Server (Сервер)

Выполняет следующие действия:

1. Создает бинарный файл `data.bin` и заполняет его начальными данными.
2. Спрашивает у пользователя количество клиентов `N` и запускает `N` процессов **Client** (`CreateProcess`).
3. Создает главный именованный канал и слушает запросы.
4. **Менеджер блокировок:** Хранит состояние каждой записи (количество читателей, наличие писателя).
5. **Обработка очереди:** 
   - Если запись занята, запрос клиента сохраняется в очереди.
   - Как только запись освобождается (приходит `READ_DONE` или `MODIFY_SUBMIT`), сервер извлекает ожидающего клиента из очереди и разрешает ему доступ.

### 2. Процесс Client (Клиент)

Выполняет следующие действия:

1. При запуске автоматически подключается к серверу.
2. Предоставляет консольное меню пользователю:
   - **Модификация (Modify):** Запрашивает доступ на запись. При успехе выводит текущие данные, запрашивает новые часы работы и отправляет обновленную запись.
   - **Чтение (Read):** Запрашивает доступ на чтение. При успехе выводит данные и ждет нажатия клавиши для завершения чтения.
   - **Выход (Exit):** Отправляет сигнал отключения и закрывается.
3. Если доступ к записи получить нельзя, клиент блокируется ("висит") до тех пор, пока сервер не пришлет разрешение (ответ через пайп).

---

## Технический стек

* **Язык:** C++ (Standard: C++17)
* **Платформа:** Windows (Windows API)
* **IPC Механизм:** Named Pipes (`CreateNamedPipe`, `CallNamedPipe`, `ReadFile`, `WriteFile`)
* **Тестирование:** GoogleTest (GTest)
* **Сборка:** CMake 3.14+

---

## Структура проекта

Решение разбито на модули для разделения логики ввода-вывода и бизнес-логики:

```text
Project Root
├── CMakeLists.txt           # Конфигурация сборки (авто-загрузка GTest)
├── Lab5_OC/                 # Папка с исходным кодом
│   ├── common.hpp           # Общие структуры (Message, Employee) и константы
│   ├── FileRepo.hpp         # Работа с файловой системой (чтение/запись структур)
│   ├── LockManager.hpp      # Логика доступа (читатели/писатели)
│   ├── PipeWrapper.hpp      # RAII-обертка над Windows Handle
│   ├── server.cpp           # Основной поток сервера, запуск клиентов
│   ├── client.cpp           # Клиентская логика и UI
│   └── unit_tests.cpp       # Unit-тесты для LockManager
